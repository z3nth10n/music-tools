<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="app_title">Guitar Chord and Note Detector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/shared.css">
  <link rel="stylesheet" href="css/chord-detector.css">
</head>

<body>
  <a href="index.html" class="back-button" aria-label="Back to Home">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
  </a>

  <div class="app">
    <div class="header-row">
      <div>
        <h1 data-i18n="main_title">Guitar Analyzer</h1>
        <p class="subtitle" data-i18n="subtitle">
          Play a note or a guitar chord. The system will try to guess the note, string/fret
          and, if possible, the chord.
        </p>
      </div>
      <div class="status-chip">
        <span id="statusDot" class="status-dot idle"></span>
        <span id="statusText" data-i18n="status_stopped">Stopped</span>
      </div>
    </div>

    <div class="controls">
      <button id="toggleButton" type="button" data-i18n="btn_start">Start Listening</button>
      
      <div style="margin-left: auto; display: flex; align-items: center; gap: 15px;">
          <div style="display: flex; align-items: center;">
            <label for="intervalInput" data-i18n="label_interval" style="margin-right: 8px; font-size: 13px; color: var(--muted);">Update (ms):</label>
            <input type="number" id="intervalInput" value="50" style="width: 50px; margin-right: 5px; padding: 4px; border-radius: 4px; border: 1px solid var(--border);">
            <button id="saveIntervalBtn" type="button" data-i18n="btn_save_interval" title="Save interval">✓</button>
          </div>

          <div style="display: flex; align-items: center;">
            <label for="notationSelect" data-i18n="label_notation" style="margin-right: 8px; font-size: 13px; color: var(--muted);">Notation:</label>
            <select id="notationSelect">
              <option value="latin" data-i18n="notation_latin">Latin (Do, Re...)</option>
              <option value="anglo" data-i18n="notation_anglo">Anglo (C, D...)</option>
            </select>
          </div>

          <div style="display: flex; align-items: center;">
            <label for="langSelect" data-i18n="label_language" style="margin-right: 8px; font-size: 13px; color: var(--muted);">Language:</label>
            <select id="langSelect">
              <option value="en">English</option>
              <option value="es">Español</option>
            </select>
          </div>
      </div>

      <div class="advanced-settings" style="margin-top: 10px;">
        <details>
          <summary style="cursor:pointer; font-size: 13px; font-weight: 600;">
            Ajustes avanzados de detección
          </summary>
          <div style="margin-top:8px; display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:8px; align-items:center;">
            
            <label style="font-size: 13px;">
              Ventana historial notas (ms)
              <input type="number" id="historyWindowInput"
                     min="100" step="50"
                     value="900"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <label style="font-size: 13px;">
              Mín. notas distintas para acorde
              <input type="number" id="minNotesForChordInput"
                     min="1" step="1"
                     value="3"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <label style="font-size: 13px;">
              Desviación máx. (cents)
              <input type="number" id="maxDeviationCentsInput"
                     min="5" step="5"
                     value="35"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <div style="display:flex; gap:8px; margin-top:4px;">
              <button type="button" id="saveDetectionSettingsBtn" class="btn-action">
                Guardar ajustes
              </button>
              <button type="button" id="resetDetectionSettingsBtn" class="btn-action">
                Reset a valores por defecto
              </button>
            </div>
          </div>
        </details>
      </div>
    </div>

    <div class="panel">
      <div class="result-chord">
        <div class="result-chord-label">
          <span data-i18n="label_chord_detected">Detected Chord</span>
          <span id="chordFreqDisplay" style="font-weight: normal; color: var(--accent); margin-left: 10px; font-size: 0.9em; opacity: 0.8;"></span>
        </div>
        <div id="chordDisplay" class="result-chord-value"></div>
        <div id="chordNotes" class="result-chord-notes" data-i18n="msg_play_chord">Play multiple strings to try to detect a chord.</div>
      </div>

      <div class="result-grid">
        <div class="result-card">
          <div class="result-label" data-i18n="label_main_note">Main Note</div>
          <div id="noteDisplay" class="result-main"></div>
          <div id="noteDetail" class="result-secondary"></div>
        </div>

        <div class="result-card">
          <div class="result-label" data-i18n="label_string_fret">Cuerda / traste sugeridos</div>
          <div id="stringFretDisplay" class="result-main"></div>
          <div id="stringFretDetail" class="result-secondary"></div>
        </div>
      </div>

      <details id="logPanel" class="log-panel" style="margin-top: 16px;">
        <summary style="cursor:pointer; font-weight: 600;">
          Logs / Debug
        </summary>
        <div class="log-panel-inner" style="margin-top: 8px;">
          <div class="log-panel-controls" style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
            <label style="font-size: 13px;">
              <input type="checkbox" id="enableLogsCheckbox" checked />
              Activar logs
            </label>
            <button type="button" id="clearLogsBtn" class="btn-action">
              Limpiar
            </button>
          </div>
          <pre id="logOutput" class="log-output"></pre>
        </div>
      </details>

      <div id="errors"></div>
      <p class="hint" data-i18n="hint_text" data-i18n-html="true">
        Consejo: usa una <strong>guitarra bien afinada</strong>, toca limpio cerca del micro y evita ruido de fondo.
        La detección de acordes es aproximada (no es tan precisa como un plugin dedicado).
      </p>
    </div>

    <canvas id="waveCanvas" width="640" height="80"></canvas>
  </div>

  <script src="js/shared/langs.js"></script>
  <script src="js/app/chord-detector.js"></script>
</body>
</html>
