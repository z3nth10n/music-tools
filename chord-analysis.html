<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¸</text></svg>">
  <title data-i18n="app_title">Guitar Chord and Note Detector</title>

  <!-- Social Media Metadata -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://z3nth10n.github.io/music-tools/chord-analysis.html">
  <meta property="og:title" content="Guitar Chord Analyzer">
  <meta property="og:description" content="Play your guitar into the microphone to detect notes and chords in real-time using your browser.">
  <meta property="og:image" content="https://z3nth10n.github.io/music-tools/images/thumb.png">

  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://z3nth10n.github.io/music-tools/chord-analysis.html">
  <meta property="twitter:title" content="Guitar Chord Analyzer">
  <meta property="twitter:description" content="Play your guitar into the microphone to detect notes and chords in real-time using your browser.">
  <meta property="twitter:image" content="https://z3nth10n.github.io/music-tools/images/thumb.png">

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/shared.css">
  <link rel="stylesheet" href="css/chord-analysis.css">
</head>

<body>
  <a href="index.html" class="back-button" aria-label="Back to Home">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
  </a>

  <div class="app">
    <div class="header-row">
      <div>
        <h1 data-i18n="main_title">Guitar Analyzer</h1>
        <p class="subtitle" data-i18n="subtitle">
          Play a note or a guitar chord. The system will try to guess the note, string/fret
          and, if possible, the chord.
        </p>
      </div>
      <div class="status-chip">
        <span id="statusDot" class="status-dot idle"></span>
        <span id="statusText" data-i18n="status_stopped">Stopped</span>
      </div>
    </div>

    <div class="controls">
      <button id="toggleButton" type="button" data-i18n="btn_start">Start Listening</button>
      
      <div class="buttonPanel" style="margin-left: auto; display: flex; flex-wrap: wrap; align-items: center; gap: 12px; justify-content: flex-end;">
          <div style="display: flex; align-items: center;">
            <label for="intervalInput" data-i18n="label_interval" style="margin-right: 6px; font-size: 13px; color: var(--muted);">Update (ms):</label>
            <input type="number" id="intervalInput" value="50" style="width: 50px; margin-right: 5px; padding: 4px; border-radius: 4px; border: 1px solid var(--border);">
            <button id="saveIntervalBtn" type="button" title="Save interval">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </button>
          </div>

          <div style="display: flex; align-items: center;">
            <label for="notationSelect" data-i18n="label_notation" style="margin-right: 6px; font-size: 13px; color: var(--muted);">Notation:</label>
            <select id="notationSelect" style="padding: 4px 8px; min-width: 100px;">
              <option value="latin" data-i18n="notation_latin">Latin (Do, Re...)</option>
              <option value="anglo" data-i18n="notation_anglo">Anglo (C, D...)</option>
            </select>
          </div>

          <div style="display: flex; align-items: center;">
            <label for="langSelect" data-i18n="label_language" style="margin-right: 6px; font-size: 13px; color: var(--muted);">Language:</label>
            <select id="langSelect" style="padding: 4px 8px; min-width: 80px;">
              <option value="en">English</option>
              <option value="es">EspaÃ±ol</option>
            </select>
          </div>

          <div class="checkbox-wrapper">
            <input type="checkbox" id="showOctaveCb">
            <label for="showOctaveCb" data-i18n="label_show_octave">Show Octave</label>
          </div>
      </div>

      <div class="advanced-settings" style="margin-top: 10px;">
        <details>
          <summary style="cursor:pointer; font-size: 13px; font-weight: 600;" data-i18n="advanced_settings_title">
            Advanced Detection Settings
          </summary>
          <div style="margin-top:8px; display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:8px; align-items:center;">
            
            <label style="font-size: 13px;">
              <span data-i18n="label_history_window">Note History Window (ms)</span>
              <input type="number" id="historyWindowInput"
                     min="100" step="50"
                     value="900"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <label style="font-size: 13px;">
              <span data-i18n="label_min_notes">Min. Distinct Notes for Chord</span>
              <input type="number" id="minNotesForChordInput"
                     min="1" step="1"
                     value="3"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <label style="font-size: 13px;">
              <span data-i18n="label_max_deviation">Max. Deviation (cents)</span>
              <input type="number" id="maxDeviationCentsInput"
                     min="5" step="5"
                     value="35"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <label style="font-size: 13px;">
              <span data-i18n="label_note_hold_time">Note Hold Time (ms)</span>
              <input type="number" id="noteHoldTimeInput"
                     min="0" step="50"
                     value="400"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <label style="font-size: 13px;">
              <span data-i18n="label_chord_min_quality">Min. Chord Quality (0-1)</span>
              <input type="number" id="chordMinQualityInput"
                     min="0.1" max="1.0" step="0.05"
                     value="0.52"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <label style="font-size: 13px;">
              <span data-i18n="label_min_volume_rms">Volume Threshold (RMS)</span>
              <input type="number" id="minVolumeRmsInput"
                     min="0.001" max="0.1" step="0.001"
                     value="0.003"
                     style="width:100%; padding:4px; border-radius:4px; border:1px solid var(--border);" />
            </label>

            <div style="display:flex; gap:8px; margin-top:4px;">
              <button type="button" id="saveDetectionSettingsBtn" class="btn-action" data-i18n="btn_save_settings">
                Save Settings
              </button>
              <button type="button" id="resetDetectionSettingsBtn" class="btn-action" data-i18n="btn_reset_settings">
                Reset to Defaults
              </button>
            </div>
          </div>
        </details>
      </div>
    </div>

    <div class="panel">
      <div class="result-chord">
        <div class="result-chord-label">
          <span data-i18n="label_chord_detected">Detected Chord</span>
          <span id="chordFreqDisplay" style="font-weight: normal; color: var(--accent); margin-left: 10px; font-size: 0.9em; opacity: 0.8;"></span>
        </div>
        <div id="chordDisplay" class="result-chord-value"></div>
        <div id="chordNotes" class="result-chord-notes" data-i18n="msg_play_chord">Play multiple strings to try to detect a chord.</div>
      </div>

      <div class="result-grid">
        <div class="result-card">
          <div class="result-label" data-i18n="label_main_note">Main Note</div>
          <div id="noteDisplay" class="result-main"></div>
          <div id="noteDetail" class="result-secondary"></div>
        </div>

        <div class="result-card">
          <div class="result-label" data-i18n="label_string_fret">Suggested String / Fret</div>
          <div id="stringFretDisplay" class="result-main"></div>
          <div id="stringFretDetail" class="result-secondary"></div>
        </div>
      </div>

      <details id="logPanel" class="log-panel" style="margin-top: 16px;">
        <summary style="cursor:pointer; font-weight: 600;" data-i18n="label_logs_debug">
          Logs / Debug
        </summary>
        <div class="log-panel-inner" style="margin-top: 8px;">
          <div class="log-panel-controls" style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
            <label style="font-size: 13px;">
              <input type="checkbox" id="enableLogsCheckbox" checked />
              <span data-i18n="label_enable_logs">Enable Logs</span>
            </label>
            <button type="button" id="clearLogsBtn" class="btn-action" data-i18n="btn_clear_logs">
              Clear
            </button>
          </div>
          <pre id="logOutput" class="log-output"></pre>
        </div>
      </details>

      <div id="errors"></div>
      <p class="hint" data-i18n="hint_text" data-i18n-html="true">
        Hint: use a <strong>well-tuned guitar</strong>, play cleanly near the mic and avoid background noise.
        Chord detection is approximate (not as precise as a dedicated plugin).
      </p>
    </div>

    <canvas id="waveCanvas" width="640" height="80"></canvas>
  </div>

  <script src="js/shared/langs.js"></script>
  <script src="js/app/chord-analysis.js"></script>
</body>
</html>
